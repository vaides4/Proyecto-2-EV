#include <Arduino.h>
#include <Wire.h>

//Pin potenciometro
#define pot 36

//leds
#define led1 26
#define led2 14
#define led3 13

//direccion I2C
#define I2C_DEV_ADDR 0x55

//declaracion funciones de callbacks para I2C
void onRequest();
void onRecieve(int len);

//declaracion de funcion para encender leds
void encenderLed(int l, int t);

//variable para leer potenciometro
uint16_t valorPot1;

//mapeo potenciometro
uint8_t mapPot1;

//variable como bandera para enviar datos I2C
bool enviar = false;

//variable que recibe info I2C
uint8_t bufferI2C;

void setup() {
  //Comenzar monitor serial
  Serial.begin(115200);

  //Setup I2C
  Serial.setDebugOutput(true);
  Wire.onReceive(onRecieve);
  Wire.onRequest(onRequest);
  Wire.begin((u_int8_t)I2C_DEV_ADDR);

  //Establecer leds como salidas
  pinMode(led1, OUTPUT);
  pinMode(led2, OUTPUT);
  pinMode(led3, OUTPUT);

  //Estado inicial leds
  digitalWrite(led1, LOW);
  digitalWrite(led2, LOW);
  digitalWrite(led3, LOW);
}

void loop() {

}

//funcion para recibir I2C
void onRecieve(int len){
  while(Wire.available()){
    bufferI2C = Wire.read();
    if(bufferI2C == '1'){
      enviar = true;
    }
    else{
      enviar = false;
    }
  }
}

//funcion para enviar I2C
void onRequest(){
  if(enviar){
    //lectura valor analogico
    valorPot1 = analogRead(pot);
    //mapeo valor analogico
    mapPot1 = map(valorPot1, 0, 4095, 0, 255);

    //enviar lectura de potenciometro
    Wire.write(mapPot1);

    enviar = false;
  }
}

//funcion para encender led
void encenderLed(int l, int t){
  if(l == 1){
    digitalWrite(led1, HIGH);
    digitalWrite(led2, LOW);
    digitalWrite(led3, LOW);
    delay(t);
    digitalWrite(led1, LOW);
  }
  else if(l == 2){
    digitalWrite(led1, LOW);
    digitalWrite(led2, HIGH);
    digitalWrite(led3, LOW);
    delay(t);
    digitalWrite(led2, LOW);
  }
  else if(l == 3){
    digitalWrite(led1, LOW);
    digitalWrite(led2, LOW);
    digitalWrite(led3, HIGH);
    delay(t);
    digitalWrite(led3, LOW);
  }
}
